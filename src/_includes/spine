<ul class="spine">
  {% for p in include.pages %}
    {% if p['group'] %}
      {% if p['group'].url == page.url %}
        <li class="spine-item spine-item-current">
          <span>
      {% else %}
        <li class="spine-item">
          <a href="{{site.baseurl}}{{p['group'].url}}">
      {% endif %}
      {{ p['group'].title }}
      {% if p['group'].url == page.url %}
        </span>
      {% else %}
        </a>
      {% endif %}
      {% assign nested_pages=p['pages'] %}
      {% include spine pages=nested_pages %}
    {% else %}
      {% if p.url == page.url %}
        <li class="spine-item spine-item-current">
          <span>
      {% else %}
        <li class="spine-item">
        {% if p.external %}
          <a href="{{p.url}}">
        {% else %}
          <a href="{{site.baseurl}}{{p.url}}">
        {% endif %}
      {% endif %}
      {{ p.title }}
      {% if p.url == page.url %}
        </span>
      {% else %}
        </a>
      {% endif %}
    {% endif %}
    </li>
  {% endfor %}
</ul>
